<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>一起出來玩｜年度紫微戰略規劃</title>
  </head>

  <body>
    <div id="app" class="min-h-screen">
      <div class="top-bar">
        📢 <strong>紫微戰略地圖</strong>｜把命盤翻譯成「今年怎麼走」
      </div>

      <div class="px-4 py-6 md:px-8 md:py-10">
        <header class="max-w-6xl mx-auto mb-7 border-b border-zinc-800 pb-5">
          <h1 class="leading-tight">
            <span
              class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-[#D4AF37]/40 bg-red-700/30 text-red-200 text-xs sm:text-sm font-black tracking-[0.22em]"
            >
              一起出來玩
            </span>

            <span class="block mt-2 text-2xl sm:text-4xl md:text-5xl font-black tracking-[0.12em] gradient-title glow-title">
              年度紫微戰略規劃
            </span>

            <span class="block mt-2 text-[11px] sm:text-xs text-zinc-400 tracking-[0.35em] uppercase">
              Ziwei Strategic Map • 2026
            </span>
          </h1>

          <div id="error-box" class="mt-4 hidden rounded border border-red-700/50 bg-red-950/40 px-3 py-2 text-sm text-red-200"></div>
        </header>

        <!-- INPUT -->
        <section id="input-section" class="max-w-2xl mx-auto card p-5 md:p-6">
          <div class="flex items-center justify-between gap-3">
            <h2 class="section-title">STEP 1｜輸入資料（西元）</h2>
            <div class="text-[11px] text-zinc-500">僅支援西元生日（最穩）</div>
          </div>

          <div class="mt-4 grid grid-cols-3 gap-3">
            <div>
              <label class="label">出生年</label>
              <select id="dob-year" class="ctrl"></select>
            </div>
            <div>
              <label class="label">出生月</label>
              <select id="dob-month" class="ctrl"></select>
            </div>
            <div>
              <label class="label">出生日</label>
              <select id="dob-day" class="ctrl"></select>
            </div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="label">出生時間（24 小時）</label>
              <input type="time" id="tob" value="12:00" class="ctrl" />
              <div class="hint">若你選了「時辰」，此欄位會自動被忽略。</div>
            </div>

            <div>
              <label class="label">時辰（子丑寅...）</label>
              <select id="shichen" class="ctrl">
                <option value="">我知道精確時間（不選時辰）</option>
                <option value="子">子</option><option value="丑">丑</option><option value="寅">寅</option>
                <option value="卯">卯</option><option value="辰">辰</option><option value="巳">巳</option>
                <option value="午">午</option><option value="未">未</option><option value="申">申</option>
                <option value="酉">酉</option><option value="戌">戌</option><option value="亥">亥</option>
              </select>

              <div id="zi-mode-wrap" class="mt-2 hidden">
                <label class="label">子時早晚</label>
                <select id="zi-mode" class="ctrl">
                  <option value="auto">不確定（自動雙盤：早子/晚子）</option>
                  <option value="late">晚子（23:00–23:59）</option>
                  <option value="early">早子（00:00–00:59）</option>
                </select>
                <div class="hint">子時可能跨日：不確定就用雙盤，避免算錯。</div>
              </div>
            </div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="label">性別</label>
              <select id="gender" class="ctrl">
                <option value="male">男</option>
                <option value="female">女</option>
              </select>
            </div>
            <div class="hidden sm:block"></div>
          </div>

          <button onclick="deployTacticalMap()" class="btn-primary mt-5 w-full">啟動演算</button>

          <div class="mt-4 text-[11px] text-zinc-500 leading-relaxed">
            提醒：若你只知道「子時」，建議選「不確定」讓系統自動雙盤，再選比較符合你的那一個版本。
          </div>
        </section>

        <!-- RESULT -->
        <section id="result-section" class="hidden max-w-6xl mx-auto">
          <!-- Desktop sticky nav -->
          <div class="sticky-nav">
            <div class="nav-wrap">
              <button class="nav-btn" onclick="scrollToSection('section-chart')">命盤檢視</button>
              <button class="nav-btn" onclick="scrollToSection('section-summary')">一分鐘摘要</button>
              <button class="nav-btn" onclick="scrollToSection('section-annual')">年度建議</button>
              <button class="nav-btn" onclick="scrollToSection('section-monthly')">2026 流月</button>
            </div>

            <div class="nav-actions">
              <button class="nav-action" onclick="exportCSV()">匯出 CSV</button>
              <button class="nav-action" onclick="deployTacticalMap()">重算</button>
              <button class="nav-action danger" onclick="resetToInput()">重新輸入</button>
            </div>
          </div>

          <!-- Mobile Floating Tab Bar -->
          <div class="bottom-tabs">
            <button class="tab-btn" onclick="scrollToSection('section-chart')">命盤</button>
            <button class="tab-btn" onclick="scrollToSection('section-summary')">摘要</button>
            <button class="tab-btn" onclick="scrollToSection('section-annual')">年度</button>
            <button class="tab-btn" onclick="scrollToSection('section-monthly')">流月</button>
          </div>

          <!-- 子時雙盤切換 -->
          <div id="zi-choice-bar" class="hidden mt-4 card p-4">
            <div class="text-[12px] text-zinc-200 font-bold mb-2">
              你選了「子時不確定」：已產生早子/晚子兩個版本（點一下切換）
            </div>
            <div class="flex flex-wrap gap-2">
              <button id="btn-zi-late" class="btn-ghost">使用晚子（23:xx）</button>
              <button id="btn-zi-early" class="btn-ghost">使用早子（00:xx）</button>
            </div>
            <div class="mt-2 text-[11px] text-zinc-500">
              小白提示：晚上十一點多出生偏晚子；半夜零點多偏早子。
            </div>
          </div>

          <!-- 年度 Hero（先給結論） -->
          <div id="section-annual" class="section-anchor"></div>
          <div class="mt-6 card p-4 md:p-5">
            <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
              <div class="min-w-0">
                <div class="text-sm font-black text-zinc-100">年度導航（先看一句話）</div>
                <div id="annual-hero-text" class="mt-2 text-[13px] leading-relaxed text-zinc-300"></div>

                <div class="mt-4">
                  <div class="text-[12px] text-zinc-500 mb-2">今年關鍵詞</div>
                  <div id="annual-keywords" class="flex flex-wrap gap-2"></div>
                </div>

                <div class="mt-4">
                  <div class="text-[12px] text-zinc-500 mb-2">核心紅綠燈（先看順的，再看修煉，再看補洞）</div>
                  <div id="annual-traffic" class="space-y-1"></div>
                </div>
              </div>

              <!-- CTA -->
              <div class="w-full md:w-[360px] consult-box">
                <div class="text-[12px] text-zinc-200 font-bold">戰略干預點｜需要人腦介入？</div>
                <div class="mt-2 text-[12px] text-zinc-400 leading-relaxed">
                  數位演算能告訴你風險在哪，但只有人類智慧能告訴你如何贏過這個風險。若你面臨人生規劃、核心職涯或企業決策的關鍵轉折，建議啟動 1 對 1 深度諮詢。
                  <span class="block mt-2 text-[11px] text-zinc-500">＊本項諮詢由李伯彥老師親自進行，旨在將數位數據轉化為可執行之商業決策。</span>
                </div>
                <a class="btn-consult mt-3 inline-flex" target="_blank" rel="noreferrer" href="https://forms.gle/Vvs6U12TeMYtab8A6">
                  申請 1 對 1 深度諮詢 ↗
                </a>
              </div>
            </div>
          </div>

          <!-- 命盤 & 宮位情報 -->
          <div id="section-chart" class="section-anchor"></div>
          <div class="mt-6 grid grid-cols-1 xl:grid-cols-3 gap-6">
            <div class="xl:col-span-2">
              <div class="card p-4 md:p-5">
                <div class="flex items-start justify-between gap-4">
                  <div>
                    <div class="text-sm font-black text-zinc-200">命盤檢視</div>
                    <div class="text-[12px] text-zinc-500 mt-1">
                      提醒：<span class="text-zinc-300 font-bold">點選不同宮位可看情報</span>
                    </div>
                  </div>
                  <div class="text-right">
                    <div id="bureau-text" class="text-[#D4AF37] font-black text-xl md:text-2xl">--局</div>
                    <div id="destiny-text" class="text-zinc-500 text-[11px] mt-1 font-mono">Analyzing...</div>
                  </div>
                </div>

                <div class="mt-4">
                  <div class="chart-grid" id="map-root">
                    <div class="center-hole text-center">
                      <div class="center-chip">2026 丙午流年：四化提示（祿權科忌）</div>
                      <div class="center-hint">點宮位 → 看白話 → 拿行動</div>
                    </div>
                    <svg id="svg-overlay"></svg>
                  </div>
                </div>
              </div>
            </div>

            <div class="xl:col-span-1 space-y-6">
              <div class="card p-4 md:p-5">
                <div class="text-sm font-black text-zinc-200 mb-2">宮位情報</div>
                <div class="text-[12px] text-zinc-500 mb-3">桌機：右側更新｜手機：底部抽屜（可左右切換）。</div>
                <div id="palace-detail" class="text-[13px] leading-relaxed">
                  <div class="text-zinc-500 text-[12px]">尚未選擇宮位。</div>
                </div>
              </div>

              <div class="card p-4 md:p-5">
                <div class="text-sm font-black text-zinc-200 mb-2">新手導覽卡</div>
                <div class="text-[12px] text-zinc-300 leading-relaxed">
                  <div>讀盤順序（小白版）：</div>
                  <div class="mt-2">
                    ① 命宮＝你怎麼做事（人設/執行）<br />
                    ② 福德＝你怎麼快樂（安全感/充電）<br />
                    ③ 疾厄＝你怎麼耗損（壓力/折舊）<br />
                    ④ 夫妻/交友＝你怎麼連結（關係/圈層）
                  </div>
                  <div class="mt-2 text-zinc-500">例：看到「化忌」＝先補洞；看到「化祿」＝抓機會。</div>
                </div>
              </div>
            </div>
          </div>

          <!-- 一分鐘摘要 -->
          <div id="section-summary" class="section-anchor"></div>
          <div class="mt-8 card p-4 md:p-5">
            <div class="text-sm font-black text-zinc-200 mb-2">命格一分鐘摘要（人生/性格）</div>
            <div id="profile-summary" class="text-[13px] leading-relaxed text-zinc-300">
              <div class="text-zinc-500 text-[12px]">請先啟動演算。</div>
            </div>
          </div>

          <!-- 流月 -->
          <div id="section-monthly" class="section-anchor"></div>
          <div class="mt-8 card p-4 md:p-5">
            <div class="flex items-center justify-between gap-3">
              <div class="text-sm font-black text-zinc-200">2026 流月戰略任務（Quest）</div>
              <button class="btn-ghost" onclick="scrollToSection('section-annual')">回年度導航</button>
            </div>

            <div id="quest-list" class="quest-grid mt-4"></div>

            <div id="consult-after-months" class="consult-box mt-6 opacity-0 translate-y-2 transition-all duration-300">
              <div class="text-[12px] text-zinc-200 font-bold">把地圖變成你的「可執行清單」</div>
              <div class="mt-2 text-[12px] text-zinc-400 leading-relaxed">
                看完 12 個月還是無法收斂成行動？可以把你今年的機會點/壓力點，轉成「逐月執行節奏」與「具體清單」。
                <span class="block mt-2 text-[11px] text-zinc-500">＊會依你盤面的四化落點、宮位場景與現況做調整。</span>
              </div>
              <a class="btn-consult mt-3 inline-flex" target="_blank" rel="noreferrer" href="https://forms.gle/Vvs6U12TeMYtab8A6">
                將戰略地圖轉化為個人執行清單 ↗
              </a>
            </div>
          </div>
        </section>
      </div>

      <!-- Mobile Bottom Sheet -->
      <div id="sheet-root" class="hidden fixed inset-0 z-[1000]">
        <div id="sheet-backdrop" class="absolute inset-0 bg-black/60"></div>

        <div
          id="sheet-panel"
          class="absolute left-0 right-0 bottom-0 translate-y-full transition-transform duration-200 bg-[#0b0b0b] border-t border-zinc-800 rounded-t-2xl shadow-2xl"
        >
          <div class="px-4 pt-3 pb-2 flex items-center justify-between gap-3">
            <div class="min-w-0 flex items-center gap-2">
              <button id="sheet-prev" class="sheet-arrow" aria-label="上一宮">◀</button>
              <button id="sheet-next" class="sheet-arrow" aria-label="下一宮">▶</button>
              <div class="min-w-0">
                <div class="text-[12px] text-zinc-400">宮位解析</div>
                <div id="sheet-title" class="text-base font-black text-zinc-100 truncate">—</div>
              </div>
            </div>
            <button id="sheet-close" class="btn-ghost">關閉</button>
          </div>
          <div class="px-4 pb-5 max-h-[70vh] overflow-y-auto custom-scrollbar" id="sheet-body"></div>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
