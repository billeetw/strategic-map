<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>紫微戰略地圖｜2026</title>
  </head>

  <body>
    <!-- Top Bar -->
    <div class="top-bar">
      📢 <strong>紫微戰略地圖</strong>｜用白話把命盤變成 2026 行動策略
    </div>

    <main class="wrap">
      <header class="max-w-6xl mx-auto mb-6 border-b border-zinc-800 pb-4 flex items-end justify-between gap-3">
        <div>
          <h1 class="text-2xl sm:text-3xl font-black tracking-widest uppercase text-red-600">Ziwei Strategic Map</h1>
          <p class="text-[10px] text-zinc-500 uppercase tracking-[0.35em] mt-1">
            Akashic Engine v9.1 · Public Edition
          </p>
        </div>

        <div class="hidden sm:flex gap-2">
          <button id="btn-reset" onclick="resetToInput()" class="btn btn-ghost hidden">重新輸入</button>
          <button id="btn-recalc" onclick="deployTacticalMap()" class="btn btn-ghost hidden">重新演算</button>
        </div>
      </header>

      <div id="error-box" class="hidden max-w-6xl mx-auto mb-4 p-3 border border-red-900 bg-red-950/30 text-red-200 text-sm"></div>

      <!-- Input -->
      <section id="input-section" class="max-w-xl mx-auto card p-5 sm:p-6">
        <h2 class="section-title">STEP 1｜輸入出生資料</h2>

        <!-- DOB dropdowns (mobile friendly) -->
        <div class="grid grid-cols-3 gap-3 mt-4">
          <div>
            <label class="label">出生年</label>
            <select id="dob-year" class="input"></select>
          </div>
          <div>
            <label class="label">出生月</label>
            <select id="dob-month" class="input"></select>
          </div>
          <div>
            <label class="label">出生日</label>
            <select id="dob-day" class="input"></select>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-3">
          <div>
            <label class="label">出生時間</label>
            <input type="time" id="tob" value="12:00" class="input w-full" />
          </div>
          <div>
            <label class="label">性別</label>
            <select id="gender" class="input w-full">
              <option value="male" selected>男</option>
              <option value="female">女</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 gap-3 mt-3">
          <div>
            <label class="label">曆法</label>
            <select id="calendar" class="input w-full">
              <option value="gregorian" selected>陽曆（西元）</option>
              <option value="lunar">農曆</option>
            </select>
            <div class="help mt-1">＊若你輸入農曆，暫以「非閏月」演算（之後可再加 UI）。</div>
          </div>
        </div>

        <button onclick="deployTacticalMap()" class="btn btn-primary w-full mt-5">
          啟動演算
        </button>

        <div class="help mt-3">
          提醒：本工具是「白話化導讀」，不是專業命理論斷與醫療建議。
        </div>
      </section>

      <!-- Result -->
      <section id="result-section" class="hidden max-w-6xl mx-auto pb-24 sm:pb-10">
        <!-- Desktop sticky nav -->
        <div class="hidden sm:block sticky top-[52px] z-40 mt-2">
          <div class="nav-bar">
            <button class="nav-btn is-active" data-nav="sec-chart">命盤（點宮）</button>
            <button class="nav-btn" data-nav="sec-summary">一分鐘摘要</button>
            <button class="nav-btn" data-nav="sec-year">年度建議</button>
            <button class="nav-btn" data-nav="sec-month">流月任務</button>

            <div class="ml-auto flex gap-2">
              <button onclick="exportCSV()" class="nav-btn nav-btn-accent">匯出 CSV</button>
            </div>
          </div>
        </div>

        <!-- Guide / onboarding card -->
        <div class="card p-4 sm:p-5 mt-4">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-sm sm:text-base font-black text-zinc-100">新手導覽卡｜怎麼看最不會迷路？</div>
              <div class="text-[12px] sm:text-[13px] text-zinc-400 mt-2 leading-relaxed">
                先點命盤的任一宮位看「白話解析」。例如：<br class="hidden sm:block" />
                <span class="text-zinc-300">命宮</span>＝你怎麼做事；
                <span class="text-zinc-300">福德</span>＝你怎麼快樂；
                <span class="text-zinc-300">疾厄</span>＝你怎麼耗損；
                <span class="text-zinc-300">夫妻/交友</span>＝你怎麼連結。
              </div>
              <div class="help mt-2">
                ✅ 提醒：點選不同宮位可看情報（手機會從下方彈出卡片）
              </div>
            </div>

            <div class="hidden sm:flex gap-2 shrink-0">
              <button class="btn btn-ghost" onclick="resetToInput()">重新輸入</button>
              <button class="btn btn-ghost" onclick="deployTacticalMap()">重新演算</button>
            </div>
          </div>

          <div class="mt-3 flex flex-wrap gap-2">
            <button class="chip" data-palace-key="命">看命宮</button>
            <button class="chip" data-palace-key="福德">看福德</button>
            <button class="chip" data-palace-key="疾厄">看疾厄</button>
            <button class="chip" data-palace-key="夫妻">看夫妻</button>
          </div>
        </div>

        <!-- SECTION: Chart -->
        <section id="sec-chart" class="section-anchor mt-6">
          <div class="section-head">
            <div>
              <div class="section-h">命盤檢視（點選 12 宮）</div>
              <div class="section-sub">點宮位看白話解析；空宮會自動「借對宮」幫你翻譯。</div>
            </div>
            <div class="text-[11px] text-zinc-500">
              <span class="inline-block">目前選擇：</span>
              <span id="selected-palace-name" class="text-zinc-300 font-bold">—</span>
            </div>
          </div>

          <div class="grid lg:grid-cols-2 gap-4">
            <!-- chart -->
            <div class="card p-3 sm:p-4">
              <div class="chart-grid" id="map-root">
                <div class="center-hole text-center">
                  <div id="bureau-text" class="text-[#D4AF37] font-black text-2xl sm:text-3xl">--局</div>
                  <div id="destiny-text" class="text-zinc-500 text-[10px] mt-2 font-mono uppercase">Analyzing...</div>
                  <div class="mt-4 px-3 py-1 bg-zinc-900 border border-zinc-700 text-zinc-400 text-[9px] font-bold">
                    2026 丙午流年：四化提示模式
                  </div>
                </div>
                <svg id="svg-overlay"></svg>
              </div>
            </div>

            <!-- palace info -->
            <div class="card p-4 sm:p-5">
              <div class="section-h">宮位情報</div>
              <div class="section-sub mb-3">點選任一宮位查看解析（手機會彈出卡片）。</div>
              <div id="palace-detail" class="text-sm"></div>
            </div>
          </div>
        </section>

        <!-- SECTION: Summary -->
        <section id="sec-summary" class="section-anchor mt-8">
          <div class="section-head">
            <div>
              <div class="section-h">命格一分鐘摘要（人生/性格）</div>
              <div class="section-sub">把術語翻成你聽得懂的「人設＋行動提示」。</div>
            </div>
            <div class="flex gap-2">
              <button onclick="exportCSV()" class="btn btn-primary">匯出 CSV</button>
            </div>
          </div>

          <div class="card p-4 sm:p-5">
            <div id="profile-summary" class="text-[13px] sm:text-[14px] leading-relaxed text-zinc-200">
              請先啟動演算。
            </div>
          </div>
        </section>

        <!-- SECTION: Annual -->
        <section id="sec-year" class="section-anchor mt-8">
          <div class="section-head">
            <div>
              <div class="section-h">年度核心戰略建議</div>
              <div class="section-sub">用四化把「今年哪裡順、哪裡卡」講清楚。</div>
            </div>
          </div>

          <div class="card p-4 sm:p-5">
            <div id="aphorism-text" class="text-[13px] sm:text-[14px] leading-relaxed text-zinc-200"></div>
          </div>
        </section>

        <!-- SECTION: Monthly -->
        <section id="sec-month" class="section-anchor mt-8">
          <div class="section-head">
            <div>
              <div class="section-h">2026 流月建議（任務清單）</div>
              <div class="section-sub">每月一句話：進攻 / 防守 / 修煉 / 穩定。</div>
            </div>
            <button class="btn btn-ghost" onclick="scrollToTopQuests()">回頂部</button>
          </div>

          <div class="card p-4 sm:p-5">
            <div id="quest-list" class="space-y-2"></div>
          </div>
        </section>
      </section>
    </main>

    <!-- Mobile bottom nav -->
    <div class="sm:hidden fixed bottom-0 left-0 right-0 z-50 border-t border-zinc-800 bg-black/80 backdrop-blur">
      <div class="grid grid-cols-4 gap-1 p-2">
        <button class="nav-btn nav-btn-mobile is-active" data-nav="sec-chart">命盤</button>
        <button class="nav-btn nav-btn-mobile" data-nav="sec-summary">摘要</button>
        <button class="nav-btn nav-btn-mobile" data-nav="sec-year">年度</button>
        <button class="nav-btn nav-btn-mobile" data-nav="sec-month">流月</button>
      </div>
    </div>

    <!-- Mobile Bottom Sheet -->
    <div id="sheet-root" class="hidden fixed inset-0 z-[60] sm:hidden">
      <div id="sheet-backdrop" class="absolute inset-0 bg-black/60"></div>
      <div
        id="sheet-panel"
        class="absolute left-0 right-0 bottom-0 translate-y-full transition-transform duration-200 bg-zinc-950 border-t border-zinc-800 rounded-t-2xl"
      >
        <div class="p-4 flex items-center justify-between gap-3 border-b border-zinc-800">
          <div id="sheet-title" class="font-black text-zinc-100">宮位解析</div>
          <button id="sheet-close" class="btn btn-ghost !py-2 !px-3">關閉</button>
        </div>
        <div id="sheet-body" class="p-4 max-h-[70vh] overflow-y-auto"></div>
      </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>

