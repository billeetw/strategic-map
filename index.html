<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>一起出來玩年度紫微戰略規劃</title>
  </head>
  <body>
    <!-- Top Bar -->
    <div class="top-bar">
      📢 <strong>紫微戰略地圖</strong>｜用白話把命盤變成可執行的年度規劃
    </div>

    <div class="wrap">
      <!-- Header -->
      <header class="header">
        <div>
          <h1 class="leading-tight">
            <span class="pill">
              一起出來玩
            </span>

            <span class="gradient-title glow-title">
              年度紫微戰略規劃
            </span>

            <span class="sub-title">
              Ziwei Strategic Map • 2026
            </span>
          </h1>
        </div>
      </header>

      <!-- Input -->
      <section id="input-section" class="panel">
        <div class="panel-title">STEP 1｜同步個人演算資料（西元生日）</div>

        <!-- DOB (Dropdown) -->
        <div class="grid-3">
          <div>
            <label class="field-label">出生年</label>
            <select id="dob-year" class="field"></select>
          </div>
          <div>
            <label class="field-label">出生月</label>
            <select id="dob-month" class="field"></select>
          </div>
          <div>
            <label class="field-label">出生日</label>
            <select id="dob-day" class="field"></select>
          </div>
        </div>

        <!-- Time + Shichen -->
        <div class="grid-2 mt-12">
          <div>
            <label class="field-label">出生時間（24 小時）</label>
            <input type="time" id="tob" value="12:00" class="field" />
            <div class="hint">若你選了「時辰」，此欄會被忽略。</div>
          </div>

          <div>
            <label class="field-label">時辰（子丑寅...）</label>
            <select id="shichen" class="field">
              <option value="">我知道精確時間（不選時辰）</option>
              <option value="子">子</option><option value="丑">丑</option><option value="寅">寅</option>
              <option value="卯">卯</option><option value="辰">辰</option><option value="巳">巳</option>
              <option value="午">午</option><option value="未">未</option><option value="申">申</option>
              <option value="酉">酉</option><option value="戌">戌</option><option value="亥">亥</option>
            </select>

            <div id="zi-mode-wrap" class="mt-10 hidden">
              <label class="field-label">子時早晚</label>
              <select id="zi-mode" class="field">
                <option value="auto">不確定（自動雙盤：早子/晚子）</option>
                <option value="late">晚子（23:00–23:59）</option>
                <option value="early">早子（00:00–00:59）</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Gender -->
        <div class="grid-2 mt-12">
          <div>
            <label class="field-label">性別</label>
            <select id="gender" class="field">
              <option value="male">男</option>
              <option value="female">女</option>
            </select>
          </div>
          <div>
            <label class="field-label">說明</label>
            <div class="hint box">
              只支援「西元出生年月日」。時辰可用「子丑寅…」。子時若不確定，系統會提供早子/晚子切換。
            </div>
          </div>
        </div>

        <div id="error-box" class="error hidden"></div>

        <button onclick="deployTacticalMap()" class="btn-primary mt-16">
          啟動戰略演算
        </button>
      </section>

      <!-- Result -->
      <section id="result-section" class="hidden">
        <!-- Quick Nav -->
        <div class="quick-nav">
          <div class="quick-nav-left">
            <button class="nav-btn" data-target="section-chart">命盤檢視</button>
            <button class="nav-btn" data-target="section-summary">一分鐘摘要</button>
            <button class="nav-btn" data-target="section-annual">年度建議</button>
            <button class="nav-btn" data-target="section-monthly">2026 流月</button>
          </div>

          <div class="quick-nav-right">
            <button class="nav-btn ghost" onclick="exportCSV()">匯出 CSV</button>
            <button id="btn-recalc" class="nav-btn ghost" onclick="deployTacticalMap()">重新演算</button>
            <button id="btn-reset" class="nav-btn ghost" onclick="resetToInput()">返回輸入</button>
          </div>
        </div>

        <!-- Chart -->
        <section id="section-chart" class="block">
          <div class="block-head">
            <div class="block-title">命盤視覺（點選 12 宮可看解析）</div>
            <div class="block-sub">提示：手機會跳出「底部抽屜」，不必上下滑很久。</div>
          </div>

          <!-- 子時雙盤切換條 -->
          <div id="zi-choice-bar" class="hidden zi-bar">
            <div class="zi-title">你選了「子時不確定」：子時可能跨日，已產生兩個版本可切換。</div>
            <div class="zi-actions">
              <button id="btn-zi-late" class="zi-btn">使用晚子（23:xx）</button>
              <button id="btn-zi-early" class="zi-btn">使用早子（00:xx）</button>
            </div>
          </div>

          <div class="chart-shell">
            <div class="chart-grid" id="map-root">
              <div class="center-hole">
                <div id="bureau-text" class="center-bureau">--局</div>
                <div id="destiny-text" class="center-sub">Analyzing...</div>
                <div class="center-badge">2026 丙午流年｜四化疊加模式</div>
              </div>
              <svg id="svg-overlay"></svg>
            </div>

            <!-- Drawer/Sidebar content (desktop) -->
            <aside class="side-panel">
              <div class="side-panel-head">
                <div class="side-title">宮位情報</div>
                <div class="side-hint">點選不同宮位可看白話解析</div>
              </div>
              <div id="palace-detail" class="side-body">
                <div class="muted">尚未選擇宮位。</div>
              </div>
            </aside>
          </div>
        </section>

        <!-- Summary -->
        <section id="section-summary" class="block">
          <div class="block-head">
            <div class="block-title">命格一分鐘摘要（人生/性格）</div>
            <div class="block-sub">把術語翻成「你真的用得上的話」。</div>
          </div>
          <div class="card">
            <div id="profile-summary" class="card-body">
              <div class="muted">請先啟動演算。</div>
            </div>
          </div>
        </section>

        <!-- Annual -->
        <section id="section-annual" class="block">
          <div class="block-head">
            <div class="block-title">年度核心戰略建議</div>
            <div class="block-sub">先看機會點（祿/科）→ 再看修煉點（權）→ 最後看補洞點（忌）。</div>
          </div>

          <div class="card">
            <div class="card-body">
              <div id="aphorism-text" class="annual-text"></div>

              <!-- 咨詢 CTA（年度判詞下方） -->
              <div id="consult-annual" class="consult-slot"></div>
            </div>
          </div>
        </section>

        <!-- Monthly -->
        <section id="section-monthly" class="block">
          <div class="block-head">
            <div class="block-title">2026 流月戰略任務（Quest System）</div>
            <div class="block-sub">讀完再看到 CTA（2 秒淡入），不打斷你吸收內容。</div>
          </div>

          <div class="card">
            <div class="card-body">
              <div id="quest-list" class="quest-list"></div>

              <div class="mt-12 flex justify-end">
                <button class="nav-btn ghost" onclick="scrollToTopQuests()">回頂部</button>
              </div>

              <!-- 咨詢 CTA（流月下方淡入） -->
              <div id="consult-monthly" class="consult-slot hidden"></div>
            </div>
          </div>
        </section>
      </section>
    </div>

    <!-- Mobile Bottom Sheet -->
    <div id="sheet-root" class="sheet hidden" aria-hidden="true">
      <div id="sheet-backdrop" class="sheet-backdrop"></div>
      <div id="sheet-panel" class="sheet-panel translate-y-full">
        <div class="sheet-head">
          <div id="sheet-title" class="sheet-title">宮位解析</div>
          <button id="sheet-close" class="sheet-close" aria-label="Close">✕</button>
        </div>
        <div id="sheet-body" class="sheet-body"></div>
      </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
